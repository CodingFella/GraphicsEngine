#include <stdio.h>
#include <stdint.h>
#include <assert.h>
#include <math.h>

#include <time.h>

#include "graphi.c"

#define WIDTH 100
#define HEIGHT 100


#define DEFAULT_FONT_HEIGHT 6
#define DEFAULT_FONT_WIDTH 6

static char graphic_glyphs[128][DEFAULT_FONT_HEIGHT][DEFAULT_FONT_WIDTH] = {
        ['a'] = {
                {0, 0, 0, 0, 0},
                {0, 1, 1, 0, 0},
                {0, 0, 0, 1, 0},
                {0, 1, 1, 1, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 1, 0},
        },
        ['b'] = {
                {1, 0, 0, 0, 0},
                {1, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 1, 1, 0, 0},
        },
        ['c'] = {
                {0, 0, 0, 0, 0},
                {0, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 0, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 0, 0},
        },
        ['d'] = {
                {0, 0, 0, 1, 0},
                {0, 1, 1, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 1, 0},
        },
        ['e'] = {
                {0, 0, 0, 0, 0},
                {0, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {1, 1, 1, 1, 0},
                {1, 0, 0, 0, 0},
                {0, 1, 1, 1, 0},
        },
        ['f'] = {
                {0, 0, 1, 1, 0},
                {0, 1, 0, 0, 0},
                {1, 1, 1, 1, 0},
                {0, 1, 0, 0, 0},
                {0, 1, 0, 0, 0},
                {0, 1, 0, 0, 0},
        },
        ['g'] = {0},
        ['h'] = {
                {1, 0, 0, 0, 0},
                {1, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
        },
        ['i'] = {
                {0, 0, 1, 0, 0},
                {0, 0, 0, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 0, 1, 0, 0},
        },
        ['j'] = {0},
        ['k'] = {
                {0, 1, 0, 0, 0},
                {0, 1, 0, 0, 0},
                {0, 1, 0, 1, 0},
                {0, 1, 1, 0, 0},
                {0, 1, 1, 0, 0},
                {0, 1, 0, 1, 0},
        },
        ['l'] = {
                {0, 1, 1, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 1, 1, 1, 0},
        },
        ['m'] = {0},
        ['n'] = {0},
        ['o'] = {
                {0, 0, 0, 0, 0},
                {0, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 0, 0},
        },
        ['p'] = {
                {1, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 1, 1, 0, 0},
                {1, 0, 0, 0, 0},
                {1, 0, 0, 0, 0},
        },
        ['q'] = {0},
        ['r'] = {
                {0, 0, 0, 0, 0},
                {1, 0, 1, 1, 0},
                {1, 1, 0, 0, 1},
                {1, 0, 0, 0, 0},
                {1, 0, 0, 0, 0},
                {1, 0, 0, 0, 0},
        },
        ['s'] = {0},
        ['t'] = {0},
        ['u'] = {0},
        ['v'] = {0},
        ['w'] = {
                {0, 0, 0, 0, 0},
                {1, 0, 0, 0, 1},
                {1, 0, 1, 0, 1},
                {1, 0, 1, 0, 1},
                {1, 0, 1, 0, 1},
                {0, 1, 1, 1, 1},
        },
        ['x'] = {0},
        ['y'] = {0},
        ['z'] = {0},

        ['A'] = {0},
        ['B'] = {0},
        ['C'] = {0},
        ['D'] = {0},
        ['E'] = {0},
        ['F'] = {0},
        ['G'] = {0},
        ['H'] = {0},
        ['I'] = {0},
        ['J'] = {0},
        ['K'] = {0},
        ['L'] = {0},
        ['M'] = {0},
        ['N'] = {0},
        ['O'] = {0},
        ['P'] = {0},
        ['Q'] = {0},
        ['R'] = {0},
        ['S'] = {0},
        ['T'] = {0},
        ['U'] = {0},
        ['V'] = {0},
        ['W'] = {0},
        ['X'] = {0},
        ['Y'] = {0},
        ['Z'] = {0},

        ['0'] = {
                {0, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 0, 0},
        },
        ['1'] = {
                {0, 0, 1, 0, 0},
                {0, 1, 1, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 1, 1, 1, 0},
        },
        ['2'] = {
                {0, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {0, 0, 0, 1, 0},
                {0, 1, 1, 0, 0},
                {1, 0, 0, 0, 0},
                {1, 1, 1, 1, 0},
        },
        ['3'] = {
                {0, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {0, 0, 1, 0, 0},
                {0, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 0, 0},
        },
        ['4'] = {
                {0, 0, 1, 1, 0},
                {0, 1, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 1, 1, 1, 1},
                {0, 0, 0, 1, 0},
                {0, 0, 0, 1, 0},
        },
        ['5'] = {
                {1, 1, 1, 0, 0},
                {1, 0, 0, 0, 0},
                {1, 1, 1, 0, 0},
                {0, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 0, 0},
        },
        ['6'] = {
                {0, 1, 1, 0, 0},
                {1, 0, 0, 0, 0},
                {1, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 0, 0},
        },
        ['7'] = {
                {1, 1, 1, 1, 0},
                {0, 0, 0, 1, 0},
                {0, 0, 1, 0, 0},
                {0, 1, 0, 0, 0},
                {0, 1, 0, 0, 0},
                {0, 1, 0, 0, 0},
        },
        ['8'] = {
                {0, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 0, 0},

        },
        ['9'] = {
                {0, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 1, 0},
                {0, 0, 0, 1, 0},
                {0, 1, 1, 0, 0},
        },

        [','] = {
                {0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0},
                {0, 0, 0, 1, 0},
                {0, 0, 1, 0, 0},
        },

        ['.'] = {
                {0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0},
                {0, 0, 1, 0, 0},
        },
        ['-'] = {
                {0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0},
                {1, 1, 1, 1, 0},
                {0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0},
        },
        [':'] = {
                {0, 0, 0, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 0, 0, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 0, 1, 0, 0},
        }
};


static uint32_t pixels[WIDTH*HEIGHT];

void draw_rect(uint32_t *canvas, size_t width, size_t height, int x, int y, int w, int h, uint32_t color) {
    if(x + w >= width || y + h >= height) {
        return;
    }

    for(int i=x; i<x+w; i++) {
        draw_line(canvas, width, height, i, y, i, y + h - 1, color);
    }
}

void draw_text(uint32_t *canvas, size_t width, size_t height, const char *text, int tx, int ty, int font_size, int glyph_size, uint32_t color) {
    for (size_t i = 0; *text; ++i, ++text) {
        int char_anchor_x = tx + font_size * i * glyph_size;
        int char_anchor_y = ty;
        const char *glyph = &graphic_glyphs[*text][0][0];


        for(int j=0; j<6; j++){
            for(int k=0; k<6; k++) {
                printf("%d ", glyph[j*6 + k]);
                if(glyph[j*6 + k]) {
                    draw_rect(canvas, width, height, char_anchor_x, char_anchor_y, font_size, font_size, color);
                }
                char_anchor_x += font_size;
            }
            char_anchor_y += font_size;
            printf("\n");
        }

    }
}



int main() {
    fill_screen(pixels, WIDTH, HEIGHT, WHITE);


    clock_t start, end;
    double cpu_time_used;

    start = clock();

    uint32_t current_color = LILAC;

    fill_screen(pixels, WIDTH, HEIGHT, current_color);

//    draw_rect(pixels, WIDTH, HEIGHT, 5, 5, 5, 5, RED);

    draw_text(pixels, WIDTH, HEIGHT, "123", 5, 5, 2, 6, RED);
    end = clock();
    cpu_time_used = ((double) (end - start)) / CLOCKS_PER_SEC;
    printf("Time taken: %f\n seconds", cpu_time_used);

    write_ppm(pixels, WIDTH, HEIGHT, "out3.ppm");


    return 0;
}
